<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ø·Ù„Ø¨ â€” Shlool Web</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0f1115; --card:#171a21; --text:#e9ecf1; --muted:#b7c0cc; --border:rgba(255,255,255,.08); --radius:18px; --accent:#0a84ff; --max:900px }
    body{
      margin:0; font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto,Arial; color:var(--text);
      background:
        radial-gradient(1200px 800px at 85% -120px, color-mix(in oklab,var(--accent) 18%, transparent), transparent 60%),
        linear-gradient(180deg,#0c0e13,var(--bg));
    }
    .topbar{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(10px);
      background:linear-gradient(90deg, color-mix(in oklab, var(--accent) 22%, transparent), transparent);
      border-bottom:1px solid var(--border); padding:10px 16px; display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .topbar .brand{display:flex; align-items:center; gap:10px; font-weight:800}
    .pill{display:inline-flex; align-items:center; gap:8px; font-weight:800; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid var(--border)}
    .wrap{max-width:var(--max); margin:auto; padding:28px 20px 40px}
    .panel{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:22px}
    h1{margin:0 0 10px; font-size:clamp(24px,4vw,34px)}
    p{color:var(--muted)}
    .steps{display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-top:14px}
    .step{padding:12px; border:1px dashed var(--border); border-radius:12px; background:rgba(255,255,255,.03); text-align:center}
    .step.active{border-style:solid; background:color-mix(in oklab, var(--accent) 14%, transparent)}
    .badge{display:inline-flex; gap:8px; font-weight:800; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid var(--border)}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; border:1px solid var(--border);
         background:linear-gradient(135deg,var(--accent),color-mix(in oklab, var(--accent) 60%, #40b3ff)); color:#fff; font-weight:800; text-decoration:none; cursor:pointer}
    .btn.ghost{background:transparent; color:var(--text)}
    .toast{position:fixed; inset:auto 20px 20px auto; background:#0e1117; border:1px solid var(--border); border-radius:12px; padding:10px 14px; opacity:0; transform:translateY(8px); transition:.25s; box-shadow:0 12px 36px rgba(0,0,0,.45)}
    .toast.show{opacity:1; transform:translateY(0)}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 3px color-mix(in oklab,var(--accent) 25%, transparent)"></span>
      Shlool Web
    </div>
    <div class="pill">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <span id="oidTop">â€”</span></div>
  </div>

  <main class="wrap">
    <section class="panel">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap">
        <h1 style="margin:0">ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ø·Ù„Ø¨</h1>
        <div class="badge">#<span id="oid">â€”</span></div>
      </div>
      <p id="state">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨â€¦</p>

      <div class="steps" id="steps" hidden>
        <div class="step" data-step="1">ğŸ“¥ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</div>
        <div class="step" data-step="2">ğŸ” ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
        <div class="step" data-step="3">ğŸ“ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±</div>
        <div class="step" data-step="4">ğŸš€ Ø¨Ø¯Ø£ Ø§Ù„ØªÙ†ÙÙŠØ°</div>
      </div>

      <div class="btns">
        <a class="btn" href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <button class="btn ghost" id="copyUrl">Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©</button>
      </div>
    </section>
  </main>

  <div class="toast" id="toast"></div>

  <script>
    // === Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙŠØ¨ Ø¢Ø¨ (ØªÙ… Ù„ØµÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø·) ===
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwDYQZgMCa3OGXNLvtNGJ9KDeI06AthQKpWrip27puCvDI7St9O3OExaekI3in1pH9brw/exec';
    const WEB_APP_TOKEN = 'Mohamad&03';

    // Toast
    const toast = document.getElementById('toast'); let tTimer;
    function notify(msg){ toast.textContent = msg; toast.classList.add('show'); clearTimeout(tTimer); tTimer = setTimeout(()=>toast.classList.remove('show'), 2200); }

    // Ù‚Ø±Ø§Ø¡Ø© id Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
    const params = new URLSearchParams(location.search);
    const orderId = params.get('id') || 'â€”';
    document.getElementById('oid').textContent = orderId;
    document.getElementById('oidTop').textContent = orderId;

    // Ù„ÙˆÙ† Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ù…Ù† thankyou (Ø¥Ù† ÙˆÙØ¬Ø¯)
    try{
      const stored = sessionStorage.getItem('orderData');
      if(stored){
        const brand = JSON.parse(stored)?.brandColor;
        if(brand && /^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$|^[a-zA-Z]+$/.test(String(brand))){
          document.documentElement.style.setProperty('--accent', String(brand));
        }
      }
    }catch{}

    // Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
    (async ()=>{
      const stateEl = document.getElementById('state');
      const stepsEl = document.getElementById('steps');

      if(!orderId || orderId==='â€”'){
        stateEl.textContent = 'Ù„Ù… ÙŠØ­Ø¯Ø¯ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨.';
        return;
      }

      try{
        const url = `${WEB_APP_URL}?id=${encodeURIComponent(orderId)}`;
        const res = await fetch(url, {method:'GET', mode:'cors'});
        const data = await res.json();

        if(!data.ok){ stateEl.textContent = 'ØªØ¹Ø°Ù‘Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©.'; return; }
        if(!data.found){ stateEl.textContent = 'Ù„Ù… Ù†Ø¬Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ù‚Ù….'; return; }

        const status = String(data.order.status||'received');
        const map = {
          received: {text:'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ âœ…', step:1},
          reviewing:{text:'Ø·Ù„Ø¨Ùƒ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ğŸ”', step:2},
          quoted:   {text:'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± ğŸ“', step:3},
          started:  {text:'Ø¨Ø¯Ø£ Ø§Ù„ØªÙ†ÙÙŠØ° ğŸš€', step:4},
          done:     {text:'Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø·Ù„Ø¨ ğŸ‰', step:4},
          cancelled:{text:'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨', step:1}
        };
        const st = map[status] || map.received;

        stateEl.textContent = st.text;
        stepsEl.hidden = false;
        document.querySelectorAll('.step').forEach(el=>{
          const s = Number(el.dataset.step);
          if(s <= st.step){ el.classList.add('active'); }
        });
      }catch(err){
        stateEl.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….';
        console.error(err);
      }
    })();

    // Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©
    document.getElementById('copyUrl').addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(location.href); notify('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ğŸ”—'); }
      catch{ notify('ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ù†Ø³Ø®.'); }
    });
  </script>
</body>
</html>
